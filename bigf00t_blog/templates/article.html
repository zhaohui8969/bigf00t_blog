{% extends "base.html" %}

{% load testmarkdown %}

{% block title %}
{{ article.title }} {%if article.subtitle %} - {{ article.subtitle }} {% endif %} · {{ block.super }}
{% endblock title %}

{% block head_description %}
{% if article.summary %}
{{ article.summary|striptags }}
{% endif %}
{% endblock head_description %}

{% block meta_tags_in_head %}
{% if article.tags or article.category or article.keywords %}

{% endif %}
{% endblock meta_tags_in_head %}

{% block content %}
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href='{% url "posts:detail" slug=obj.slug %}'> {{ obj.title }} {%if page.subtitle %} <small> {{ page.subtitle }} </small> {% endif %} </a></h1>
    </header>
</div>

<div class="row-fluid">
    {% if article.toc %}
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        {{ article.toc }}
        </nav>
    </div>
    <div class="span8 article-content">
        {% else %}
        <div class="span8 offset2 article-content">
            {% endif %}

            {{ obj.content|markme:obj }}
            
            {% if obj.canlist %}
            {% include 'comments.html' %}
            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
                {% if previous_article %}
                <li class="previous_article">« <a href='{% url "posts:detail" slug=previous_article.slug %}' title="Previous: {{ previous_article.title }}">{{ previous_article.title }}</a></li>
                {% endif %}
                {% if next_article %}
                <li class="next_article"><a href='{% url "posts:detail" slug=next_article.slug %}' title="Next: {{ next_article.title }}">{{ next_article.title }}</a> »</li>
                {% endif %}
            </ul>
            </nav>
            </aside>
            {% if DUOSHUO_SITENAME and article.status != "draft" %}
                <h2>评论 !</h2>
                <!-- 多说评论框 -->
                <div class="ds-thread" data-title={{article.title}}></div>
                <script type="text/javascript">
                var duoshuoQuery = {short_name:"bigf00t"};
                (function() {
                      var ds = document.createElement('script');
                      ds.type = 'text/javascript';ds.async = true;
                      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                      ds.charset = 'UTF-8';
                      (document.getElementsByTagName('head')[0] 
                       || document.getElementsByTagName('body')[0]).appendChild(ds);
                })();
                </script>
            {% endif %}
            {% endif %}
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            {% if obj.canlist %}
            {% if not obj.draft %} 
            <h4>已发布</h4>
            <time pubdate="pubdate" datetime="{{ obj.publishtime }}">{{ obj.publishtime }}</time>
            {% endif %}
            {% if obj.updatetime %} 
            <h4>最后更新</h4>
            <div class="last_updated">{{ obj.updatetime }}</div>
            {% endif %}
            {% if obj.category %}
            <h4>分类</h4>
            <a class="category-link" href="/categories.html#{{ category }}-ref">{{ obj.category }}</a>
            {% endif %}
            {% if article.tags %}
            <h4>标签</h4>
            <ul class="list-of-tags tags-in-article"> 
                {% for tag in article.tags %}
                <li><a href="/tags.html#{{ tag }}-ref">{{ tag }}
                    //tag
                {% endfor %}
            </ul>
            {% endif %}
            {% endif %}
        </div>
        </section>
</div>
</article>
{% endblock content %}


{% block script %}
    {{ block.super }}
    {% include 'disqus_script_count.html' %}
    {% if DISQUS_SITENAME and SITEURL and article.status != "draft" %}
        <script  language="javascript" type="text/javascript">
            function uncollapse() {
                var hash_str = window.location.hash;
                if (window.location.hash.match(/^#comment-\d+$/))
                {
                    var hash_str = '#disqus_thread';
                }
                $(hash_str).collapse({
                    toggle: true
                    })
            }
        </script>

        <script type="text/javascript" language="JavaScript">
            uncollapse(); 
        </script>
    {% endif %}
    
{% endblock script %}
